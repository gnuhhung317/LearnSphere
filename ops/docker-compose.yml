version: '3.8'

#
# Development Environment for StudyHub Microservices
#
services:
  # 1. Identity & Access Management
  keycloak:
    image: quay.io/keycloak/keycloak:25.0
    container_name: keycloak
    command: start-dev
    environment:
      - KEYCLOAK_ADMIN=admin
      - KEYCLOAK_ADMIN_PASSWORD=admin
    ports:
      - "8080:8080"
    networks:
      - studyhub-net

  # 2. Databases
  postgres-user-db:
    image: postgres:16-alpine
    container_name: postgres-user-db
    environment:
      - POSTGRES_DB=user_service_db
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
    ports:
      - "5432:5432"
    volumes:
      - postgres-user-data:/var/lib/postgresql/data
    networks:
      - studyhub-net

  postgres-chat-db:
    image: postgres:16-alpine
    container_name: postgres-chat-db
    environment:
      - POSTGRES_DB=chat_service_db
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
    ports:
      - "5433:5432" # Map to a different host port
    volumes:
      - postgres-chat-data:/var/lib/postgresql/data
    networks:
      - studyhub-net

  # # 3. Messaging
  # zookeeper:
  #   image: confluentinc/cp-zookeeper:7.5.3
  #   container_name: zookeeper
  #   environment:
  #     ZOOKEEPER_CLIENT_PORT: 2181
  #     ZOOKEEPER_TICK_TIME: 2000
  #   networks:
  #     - studyhub-net

  # kafka:
  #   image: confluentinc/cp-kafka:7.5.3
  #   container_name: kafka
  #   depends_on:
  #     - zookeeper
  #   ports:
  #     - "9092:9092"
  #     - "29092:29092"
  #   environment:
  #     KAFKA_BROKER_ID: 1
  #     KAFKA_ZOOKEEPER_CONNECT: 'zookeeper:2181'
  #     KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
  #     KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092,PLAINTEXT_HOST://localhost:29092
  #     KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
  #     KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
  #   networks:
  #     - studyhub-net

  # rabbitmq:
  #   image: rabbitmq:3.13-management-alpine
  #   container_name: rabbitmq
  #   ports:
  #     - "5672:5672"  # AMQP port
  #     - "15672:15672" # Management UI
  #   environment:
  #     - RABBITMQ_DEFAULT_USER=user
  #     - RABBITMQ_DEFAULT_PASS=password
  #   networks:
  #     - studyhub-net

  # # 4. Caching
  # redis:
  #   image: redis:7-alpine
  #   container_name: redis
  #   ports:
  #     - "6379:6379"
  #   networks:
  #     - studyhub-net

  # # 5. Object Storage
  # minio:
  #   image: quay.io/minio/minio:RELEASE.2024-07-23T00-09-38Z
  #   container_name: minio
  #   command: server /data --console-address ":9001"
  #   ports:
  #     - "9000:9000" # API port
  #     - "9001:9001" # Console UI
  #   environment:
  #     - MINIO_ROOT_USER=minioadmin
  #     - MINIO_ROOT_PASSWORD=minioadmin
  #   volumes:
  #     - minio-data:/data
  #   networks:
  #     - studyhub-net

  # # 6. Observability
  # zipkin:
  #   image: openzipkin/zipkin:3
  #   container_name: zipkin
  #   ports:
  #     - "9411:9411"
  #   networks:
  #     - studyhub-net

networks:
  studyhub-net:
    driver: bridge

volumes:
  postgres-user-data:
  postgres-chat-data:
  minio-data:
